local v1 = game:GetService("CoreGui")
local v2 = v1:FindFirstChild("ToraScript")

if v2 then
    v2:Destroy()
end

local v3 = game:GetService("Players")
local v4 = v3.LocalPlayer

local v5 = loadstring(game:HttpGet("https://raw.githubusercontent.com/liebertsx/Tora-Library/main/src/librarynew", true))()

local v6 = v5:CreateWindow("Jail a Brainrot OP")

local function getMyTycoon()
    local tycoons = workspace.Game.Tycoons
    for _, tycoon in pairs(tycoons:GetChildren()) do
        local data = tycoon:FindFirstChild("Data")
        if data then
            local owner = data:FindFirstChild("Owner")
            if owner and owner.Value == v4.Name then
                return tycoon
            end
        end
    end
    return nil
end

local function stealBrainrot(brainrot)
    pcall(function()
        local hrp = v4.Character and v4.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        
        local target = brainrot.PrimaryPart or brainrot:FindFirstChild("HumanoidRootPart") or brainrot:FindFirstChildOfClass("BasePart")
        if target then
            hrp.CFrame = target.CFrame * CFrame.new(0, 5, -4)
            task.wait(0.15)
            
            firetouchinterest(hrp, target, 0)
            task.wait(0.1)
            firetouchinterest(hrp, target, 1)
        end
        
        local stealPrompt = brainrot:FindFirstChild("HumanoidRootPart") 
            and brainrot.HumanoidRootPart:FindFirstChild("Steal")
        if stealPrompt and stealPrompt:IsA("ProximityPrompt") then
            fireproximityprompt(stealPrompt)
            print("¡FIRING Steal ProximityPrompt en " .. brainrot.Name .. "!")
        end
    end)
end

local function tpToBrainrot(brainrot)
    pcall(function()
        local hrp = v4.Character and v4.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        
        local target = brainrot.PrimaryPart or brainrot:FindFirstChild("HumanoidRootPart") or brainrot:FindFirstChildOfClass("BasePart")
        if target then
            hrp.CFrame = target.CFrame * CFrame.new(0, 5, -4)
            print("TP instantáneo a " .. brainrot.Name .. " (" .. (brainrot:GetAttribute("Rarity") or "Unknown") .. ")")
        end
    end)
end

local function tpBackToTycoon()
    task.wait(0)  -- inmediato
    pcall(function()
        local tycoon = getMyTycoon()
        if tycoon then
            local spawn = tycoon:FindFirstChild("Spawn")
            if spawn and v4.Character and v4.Character:FindFirstChild("HumanoidRootPart") then
                v4.Character.HumanoidRootPart.CFrame = spawn.CFrame + Vector3.new(0, 5, 0)
                print("¡Volví inmediatamente a tu tycoon/plot! (" .. tycoon.Name .. ")")
            end
        end
    end)
end

-- Botón Steal Best Brainrot
v6:AddButton({
    text = "Steal Best Brainrot",
    callback = function()
        pcall(function()
            local characters = workspace.Essentials.Characters:GetChildren()
            local best = nil
            local bestCPS = -1
            local bestPriority = -1
            
            local rarityOrder = {
                ["Secret"] = 6,
                ["God"] = 5,
                ["Mythic"] = 4,
                ["Epic"] = 3,
                ["Rare"] = 2,
                ["Common"] = 1
            }
            
            for _, char in ipairs(characters) do
                if char:IsA("Model") then
                    local rarity = char:GetAttribute("Rarity") or "Common"
                    local cps = tonumber(char:GetAttribute("CPS")) or 0
                    local priority = rarityOrder[rarity] or 0
                    
                    if cps > bestCPS or (cps == bestCPS and priority > bestPriority) then
                        bestCPS = cps
                        bestPriority = priority
                        best = char
                    end
                end
            end
            
            if best then
                stealBrainrot(best)
                print("¡Robado el mejor! CPS: " .. (best:GetAttribute("CPS") or "?") .. " | Rarity: " .. (best:GetAttribute("Rarity") or "Unknown"))
                task.wait(0.1)
                tpBackToTycoon()
            else
                print("No hay brainrots pa robar")
            end
        end)
    end,
    flag = "stealBest"
})

v6:AddButton({
    text = "Goto Tycoon",
    callback = function()
        pcall(function()
            local tycoon = getMyTycoon()
            if tycoon and tycoon:FindFirstChild("Spawn") then
                local hrp = v4.Character and v4.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    hrp.CFrame = tycoon.Spawn.CFrame + Vector3.new(0, 5, 0)
                    print("¡TP a tu tycoon! (" .. tycoon.Name .. ")")
                end
            else
                print("No se encontró tu tycoon o el Spawn")
            end
        end)
    end,
    flag = "gotoTycoon"
})

-- Auto Sell All
local autoSell = false
v6:AddToggle({
    text = "Auto Sell All",
    state = false,
    callback = function(val)
        autoSell = val
    end,
    flag = "autoSell"
})

task.spawn(function()
    while true do
        task.wait(0.5)
        if autoSell then
            pcall(function()
                game:GetService("ReplicatedStorage").Remotes.Sell:FireServer(true)
            end)
        end
    end
end)

-- Auto Find Toggles
local autoFindEpic = false
local autoFindMythic = false
local autoFindLegendary = false

v6:AddToggle({
    text = "Auto Find Epic",
    state = false,
    callback = function(val)
        autoFindEpic = val
    end,
    flag = "autoFindEpic"
})

v6:AddToggle({
    text = "Auto Find Mythical",
    state = false,
    callback = function(val)
        autoFindMythic = val
    end,
    flag = "autoFindMythical"
})

v6:AddToggle({
    text = "Auto Find Legendary",
    state = false,
    callback = function(val)
        autoFindLegendary = val
    end,
    flag = "autoFindLegendary"
})

-- Loop principal de auto find (muy rápido - cada 0.1s)
task.spawn(function()
    while true do
        task.wait(0.1)
        
        if not (autoFindEpic or autoFindMythic or autoFindLegendary) then
            continue
        end
        
        pcall(function()
            local characters = workspace.Essentials.Characters:GetChildren()
            
            for _, char in ipairs(characters) do
                if not char:IsA("Model") then continue end
                
                local rarity = char:GetAttribute("Rarity")
                if not rarity then continue end
                
                local shouldSteal = false
                
                if rarity == "Epic"      and autoFindEpic      then shouldSteal = true
                elseif rarity == "Mythic" and autoFindMythic   then shouldSteal = true
                elseif rarity == "Legendary" and autoFindLegendary then shouldSteal = true
                end
                
                if shouldSteal then
                    tpToBrainrot(char)
                    task.wait(0.08)          -- mini delay para que el tp se registre
                    stealBrainrot(char)
                    task.wait(0.12)          -- pequeño tiempo extra para que el steal procese
                    tpBackToTycoon()
                end
            end
        end)
    end
end)

-- WalkSpeed Slider
v6:AddSlider({
    text = "Walk Speed",
    min = 16,
    max = 140,
    default = 16,
    callback = function(value)
        local humanoid = v4.Character and v4.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = value
        end
    end,
    flag = "WalkSpeed"
})

v6:window:AddLabel({text = "Youtube: zeroz560"})

v5:Init()
